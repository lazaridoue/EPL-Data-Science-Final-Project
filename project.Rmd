---
title: "Final Team Project"
author: "Daisy Asiimwe, Eleni L., and Emi Torres-Vera"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_height: 5
    fig_width: 5
    text-indent: 50px
    toc_float: yes
    pdf_document:
    toc: yes
---
![](Premier_League_Logo.svg.png)

# Introduction

<p> The _English Premier League_ is the top league of England's football, with **20 teams** fighting to be crowned the English champions. Premier League was founded in 1992, and it became widely known around the world due to its strong financial support and global broadcasting. One season in The _English Premier League_ begins in August and ends at the end of May. Each team plays with each other on home and away games. For each game, each team gets awarded 3 points for a win, 1 point for a draw, and no points for a defeat. Manchester United has won the title 13 times, Chelsea has won it 5 times, and Manchester City has won it 4 times so far. The top 4 teams of the season are promoted to compete in the Champions League. The next 3 are competing for the participation in the Europa League competition, and the last 3 teams are moved to relegation. </p>
</p> In our data science project, we will analyze data from the last 2 seasons, one of which has not been completed yet. The 2 seasons are 2018-2019 and 2019-2020 season. Our idea is to work on predicting the standings of the clubs at the end of the season 2019-2020 for the _English Premier League_. Some of the research ideas we are going to include are, which team is most likely to win the current season of the _Premier League_, and which are most likely to be the top 5 teams in the standing. In addition to that, we are going to closely study whether scoring the most goals get titles for the team and if there exists a home advantage for the games played on the home field. </p>
<p> Our team chose to work on a topic about The English Premier League because football is a sport that we have invested personal interest in, as we enjoyed playing and watching football. Additionally, due to COVID-19, like other activities, the _English Premier League_ 2019-2020 season has been put on hold which has left football fans suspenseful. As enthusiastic football fans, we would like to use the knowledge that we have acquired in the data science class to predict outcomes that would have happened in the 2019-2020 season of _The English Premier League_ if there had not been a global pandemic of the COVID-19. </p> 

# Data 
<p> This is where we imported the data. We imported 5 files. 4 of these files were datasets which helped us decide the outcome of the 2020 season. We had data from the 2018, 2019, 2020 premier league season. We also had a datset for games left for the top 10 teams in 2020.For these datasets we had to clean the data. We had datasets from these seasons that had missing information and some very important information for predicting the winner of the 2020 season. We had to delete the uneccesary columns and keep the important data. We had missing information that was very key for finding our final answers such as goal differentials, total points, and chances missed and much more. We found the inforamtion needed and made a new spreadsheet and filled in the data to meet our needs and this was how we cleaned the data to get what we needed.</p>
```{r imports}
# Add needed libraries, import all needed data, and show glimspses of all data here
library(tidyverse)
library(readxl)
EPL_18<-read_excel("2018 Top 10.xlsx")
EPL_18$GD <- c(EPL_18$Goals-EPL_18$GC)
EPL_19<-read_excel("2019 Top 10.xlsx")

EPL_20<-read_excel("2020 Top 10.xlsx")
EPL_20$GD <- c(EPL_20$Goals-EPL_20$GC)
EPL_20$Results <- c(EPL_20$PTS)

Games_left <- read_excel("Games Left Top 10.xlsx")
```

<p> head(EPL_18) is containing the table from the 2018 season. This season Manchester City won with 100 points. No other team seems to be close to the champions of this season. This table shows the stats from the top 10 finishing teams from the 2018 season. </p>

```{r head}
head(EPL_18)
```

<p> head(EPL_19) is showing once again that Manchester City finihsed with 98 points in the season which made them champions. Liverpool was only 1 point behind the champions meaning the title was between them two all season. </p>

```{r head2}
head(EPL_19)
```

<p> head(EPL_20) is showing the current standings of the 2020 season. This season was supposed to be over a while ago but due to Covid-19 the season was delayed and will begin June 17th. This table shows the amount of games each team has played and their stats. Liverpool is on top with 82 points with a big gap between second place team Manchester City with 57 points. We are using this tables stats to compare them to the past seasons to predict the outcome for this table. </p>

```{r head3}
head(EPL_20)
``` 


### Here is a glimpse of the data for the season 2017-2018:

```{r glimpse1} 
glimpse(EPL_18, width = 3)
```


### Here is a glimpse of the data for the season 2018-2019:

```{r glimpse2} 
glimpse(EPL_19, width = 3)
```


### Here is a glimpse of the data for the season 2019-2020:

```{r limpse3} 
glimpse(EPL_20, width = 3)
```

# Primary Write-up

We are mainly using the teams past data in order to predict the team’s performance. We used the datasets available from https://www.kaggle.com/thesiff/premierleague1819 and https://www.kaggle.com/idoyo92/epl-stats-20192020, which consists of all the results from 2018-2020, compiled into CSV files. The next step was to discover the dominating factors that interact well with team strength.

## Key Outcomes
## Summary statistics and visualizations
### For Season 2017-2018
<p> The graph shows a positive correlation between the goals scored and the points earned by the top ten football teams in the European Premier League in the 2017- 2018 season. As illustrated by the graph, the higher the number of goals scored by the team, the more points earned by that team. For example, the graph shows that Manchester City had the highest number of goals scored and points earned compared to Burnley which had the lowest number of goals scored and points earned in 2017-2018 Premier League Season.</p>

```{r stats-1}
# Add these sections as needed, giving them unique names
ggplot(data=EPL_18, aes(x=PTS, y= Goals))+
  geom_point(mapping=aes(color= Team),stat = "identity") + 
  xlab("Points") +
  ylab("Goals Scored")+
  geom_smooth(method = "lm", se = FALSE) 

```

### For Season 2018-2019
<p> The graph shows a positive correlation between the goals scored and the points earned by the top ten football teams in the European Premier League in the 2018- 2019 season. As illustrated by the graph, the higher the number of goals scored by the team, the more points earned by that team. For example, the graph shows that Manchester City had the highest number of goals scored and points earned compared to Wolverhampton which had the lowest number of goals scored and points earned in 2018-2019 Premier League Season. </p>

```{r stats-2}
# Add these sections as needed, giving them unique names
ggplot(data=EPL_19, aes(x=PTS, y= Goals))+
  geom_point(mapping= aes(color= Team), stat = "identity") + 
  xlab("Points") +
  ylab("Goals Scored")+
  geom_smooth(method = "lm", se = FALSE)

```

### For Season 2019-2020 
<p> The graph shows there will be a  positive correlation between the goals scored and the points earned by the top ten football teams in the European Premier League in the 2019- 2020 season. As illustrated by the graph, the higher the number of goals scored by the team, the more points earned by that team. For example, the graph shows that Manchester City will have the highest number of goals scored and points earned compared to Sheffield United which will have the lowest number of goals scored and points earned in the 2019-2020 Premier League Season.The model demonstrated by the graph shows that 2019-2020 season ranking will be Manchester city, Liverpool, Leicester city, Chelsea, Tottenham, Manchester united, Wolverhampton, Arsenal, Burnley and Sheffield united respectively. </p> 

```{r stats-3}
# Add these sections as needed, giving them unique names
ggplot(data=EPL_20, aes(x=PTS, y= Goals))+
  geom_point(mapping= aes(color= team), stat = "identity") + 
  xlab("Points") +
  ylab("Goals Scored")+
  geom_smooth(method = "lm", se = FALSE)

```
## Here we have the prediction model, for the final standing of the English Premier League season 2019-2020.

<p> First we assigned the values of the average goals scored for each of the team at their Home and on an Away field. Similarly we worked on how many goals were conceded by each team either Home or Away </p>

```{r Prediction Model}
# Add these sections as needed, giving them unique names
#The order goes as follow Liverpool (1), Man City (2), Leicester City (3), Chelsea (4), Man U(5), Wolves (6), Sheffield (7), Tottenham (8), Arsenal (9), Burnley (10).
#Home Score Average number of goals scored in home matches
Home_Scored <- c(2.67, 2.54, 2.00, 1.47,1.93, 1.40, 1.13,1.93,1.73, 1.33)
#Home Conceded Average number of goals conceded in home matches
Home_Conceded <- c(0.80, 0.92, 1.00, 1.00, 0.80,1.13, 0.87,1.07, 1.33, 1.27)
#Away Score Average number of goals scored in away matches
Away_Scored <- c(1.86,2.33, 2.00,2.07,1.07, 1.43,1.00, 1.33, 1.08, 1.00)
#Away Conceded Average number of goals conceded in away matches
Away_Conceded <- c(0.64, 1.27, 0.93,1.71,1.29, 1.21, 0.92,1.67,1.23, 1.50)
```
The histogram shows a distribution of how often goals are scored by the home teams in the English Premier League. __Scenario to explain histogram:__ If Berea College soccer team played against Barnard College soccer at the Berea College stadium, the histogram demonstrates that Berea College soccer team is more likely to score more goals at home (College stadium).

```{r Histogram1}
hist(Home_Scored)
```

The histogram shows that the distribution of the goals scored away is roughly symmetrical and bimodal. The goals scored away are relatively spread out. The EPL teams playing away from how are less likely to score goals. __Scenario:__ If Berea College soccer team plays at the Barnard College soccer stadium, they are less likely to score.

```{r Histogram2}
hist(Away_Scored)
```

The histogram shows the goals that the away team scored at the home team stadium in the EPL. The distribution shows that the away team is more likely not to score. __Scenario:__ If Barnard College soccer is playing at the Berea College stadium, they are less likely to score at the Berea College stadium.

```{r Histogram3}
hist(Home_Conceded)
```

The histogram shows a distribution that is symmetrical. The distribution shows the likelihood of away teams to score at the home team stadium. __Scenario:__ If  Berea College was playing at the Barnard College stadium, they are relatively less likely to score at the Barnard College stadium. 

```{r Histogram4}
hist(Away_Conceded)
```

```{r Mean Value}
League_Home_Scored <- mean(Home_Scored)
League_Away_Scored <- mean(Away_Scored)


League_Home_Conceded <- mean(Home_Conceded)
League_Away_Conceded <- mean(Away_Conceded)

Home_Attack_Strength <- c(Home_Scored/League_Home_Scored)
Home_Defense_Strength <- c(Home_Conceded/League_Home_Conceded)

Away_Attack_Strength <- c(Away_Scored/League_Away_Scored)
Away_Defense_Strength <- c(Away_Conceded/League_Away_Conceded)
  
Overall_Goals_Home <- (League_Home_Scored+League_Away_Conceded)/2
Overall_Goals_Away <- (League_Away_Scored+League_Home_Conceded)/2
```
```{r calculate score probability}
Calculate_lambda <- function(Home, Away){
  LambdaH <- Home_Attack_Strength[Home] * Away_Defense_Strength[Away] * Overall_Goals_Home
  LambdaA <- Home_Attack_Strength[Away] * Away_Defense_Strength[Home]* Overall_Goals_Home
Lambdas <- c(round(LambdaH), round(LambdaA))
return(Lambdas)
}

Calculate_lambda
```
```{r Game prediction function}
Predict_Game <- function(Home, Away, score_vector){
  Lambdas <- Calculate_lambda(Home, Away)
  #Lambda1 would be the score for the home team
  #Lambda2 would be the score for the away team
  Lambda1 <- Lambdas[1]
  Lambda2 <- Lambdas[2]
  if (Lambda1 == Lambda2){ #If there is a tie between the teams
    score_vector[Home] <- score_vector[Home] + 1 
    score_vector[Away] <- score_vector[Away] + 1
    }
  else if (Lambda1 > Lambda2){ #If Home wins
    score_vector[Home] <- score_vector[Home] + 3 }
  else { #If Away wins
    score_vector[Away] <- score_vector[Away] + 3 }
  return(score_vector)
}

for(i in (1:20)){
  EPL_20$Results <- Predict_Game(Games_left$Home[i], Games_left$Away[i], EPL_20$Results) }

final_standing <- data.frame(EPL_20$team, EPL_20$Results)
str(final_standing)

final_standing[rev(order(final_standing$EPL_20.Results)),]
```

## Summarized Results
<p> The summarized results we have found are that there is a linear coorelation between the goals scored by a team and whether or not a team gets more points. In addition to that, we also have found out that there is actually a home advantage for the teams playing on their home stadium. </p>

## Critique


## Learning


## Conclusion and Discussion


## Resources Used
<div id="refs">Yoely, Ido. (2020). English Premier League stats 2019-2020 [Data set]. Kaggle.   https://www.kaggle.com/idoyo92/epl-stats-20192020?select=players_1920.csv </div>

<div id="refs">Peacock, Chas. (2019, Aug 25). 2018-2019 Premier League matches [Data set]. data.world. https://data.world/chas/2018-2019-premier-league-matches</div>

<div id="refs">Premier League. (2020, May 26). Retrieved from https://en.wikipedia.org/wiki/Premier_League</div>

<div id="refs">Gupta, Apaar. (2019, Jan 30). Predicting Premier league standings — putting that math to some use. Medium. https://towardsdatascience.com/predicting-premier-league-standings-putting-that-math-to-some-use-e8de64938d7 </div>

<div id="refs">Premier League. (2020, June 01). Football News, Fixtures, Scores & Results. Premier League. https://www.premierleague.com/ </div>
